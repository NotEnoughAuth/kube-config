apiVersion: apps/v1
kind: Deployment
metadata:
  name: dendrite-matrix
  namespace: matrix
  labels:
    app: dendrite-matrix
spec:
  replicas: 3
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: dendrite-matrix
  template:
    metadata:
      labels:
        app: dendrite-matrix
    spec:
      containers:
        - name: dendrite-matrix
          image: matrixdotorg/dendrite-monolith:v0.13.5
          ports:
          - containerPort: 8008
            hostPort: 8008
          - containerPort: 8448
            hostPort: 8448
          volumeMounts:
          - name: config
            mountPath: /etc/dendrite
          - name: media
            mountPath: 
          - name: key
            readOnly: true
            mountPath: /etc/dendrite

      volumes:
        - name: config
          projected:
            sources:
              - secret:
                name: matrix-config
              - secret:
                name: matrix-key
        - name: media
          persistentVolumeClaim:
            claimName: media-matrix-pvc